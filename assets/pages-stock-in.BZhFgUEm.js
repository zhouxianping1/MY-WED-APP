import{$ as e,g as t,Q as a,n as l,b as i,R as s,N as n,r as o,e as c,w as r,i as u,o as d,j as h,f,t as p,h as m,v as g,P as _,l as y,I as v,S as k,m as C}from"./index-D1azYyZI.js";import{C as M}from"./CustomNavBar.CZ4sq6xv.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=b({components:{CustomNavBar:M},data(){return{navBarHeight:64,materialOptions:[],materialIndex:0,selectedMaterial:null,quantity:"",supplier:"",date:this.formatDate(new Date),remark:"",loading:!1,unitOptions:["kg","t"],unitIndex:-1,displayUnit:"è¯·é€‰æ‹©å•ä½"}},onLoad(){this.getNavBarHeight(),this.fetchMaterials()},methods:{getNavBarHeight(){e("updateNavBarHeight",(e=>{this.navBarHeight=e}));try{const e=t("navBarHeight");e&&(this.navBarHeight=e)}catch(a){}},async fetchMaterials(){var e;try{a({title:"åŠ è½½ä¸­"});const t=await l.callFunction({name:"material",data:{action:"getMaterials",data:{page:1,pageSize:100}}});t.result&&0===t.result.code?(this.materialOptions=t.result.data.materials||[],this.materialOptions.length>0&&(this.selectedMaterial=this.materialOptions[0])):i({title:(null==(e=t.result)?void 0:e.msg)||"è·å–åŸæ–™åˆ—è¡¨å¤±è´¥",icon:"none"})}catch(t){console.error("è·å–åŸæ–™åˆ—è¡¨å¤±è´¥",t),i({title:"è·å–åŸæ–™åˆ—è¡¨å¤±è´¥",icon:"none"})}finally{s()}},onMaterialChange(e){const t=e.detail.value;this.materialIndex=t,this.selectedMaterial=this.materialOptions[t]},onUnitChange(e){const t=e.detail.value;this.unitIndex=t,this.displayUnit=this.unitOptions[t]},onDateChange(e){this.date=e.detail.value},formatDate:e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,async handleSubmit(){var e;if(!this.selectedMaterial)return i({title:"è¯·é€‰æ‹©åŸæ–™",icon:"none"});if(!this.quantity||isNaN(Number(this.quantity))||Number(this.quantity)<=0)return i({title:"è¯·è¾“å…¥æœ‰æ•ˆçš„å…¥åº“æ•°é‡",icon:"none"});if(-1===this.unitIndex)return i({title:"è¯·é€‰æ‹©å•ä½",icon:"none"});if(!this.date)return i({title:"è¯·é€‰æ‹©å…¥åº“æ—¥æœŸ",icon:"none"});try{this.loading=!0,a({title:"æäº¤ä¸­"});let t=Number(this.quantity);"kg"===this.displayUnit&&(t/=1e3);const o=await l.callFunction({name:"stock-record",data:{action:"addStockRecord",data:{material_id:this.selectedMaterial._id,quantity:t,type:"in",remark:{text:`ä¾›åº”å•†: ${this.supplier||"æœªå¡«å†™"}, å¤‡æ³¨: ${this.remark||"æ— "}`}}}});o.result&&0===o.result.code?(i({title:"å…¥åº“æˆåŠŸ",icon:"success"}),setTimeout((()=>{n()}),1500)):i({title:(null==(e=o.result)?void 0:e.msg)||"å…¥åº“å¤±è´¥",icon:"none"})}catch(t){console.error("å…¥åº“æ“ä½œå¤±è´¥",t),i({title:"å…¥åº“æ“ä½œå¤±è´¥",icon:"none"})}finally{this.loading=!1,s()}},handleCancel(){n()}}},[["render",function(e,t,a,l,i,s){const n=o("custom-nav-bar"),M=u,b=_,x=y,N=v,B=k,q=C;return d(),c(M,{class:"stock-in-container"},{default:r((()=>[h(n,{title:"å…¥åº“æ“ä½œ",showBack:!0}),h(M,{class:"page-content",style:g({paddingTop:i.navBarHeight+20+"px"})},{default:r((()=>[h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("é€‰æ‹©åŸæ–™")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(b,{onChange:s.onMaterialChange,value:i.materialIndex,range:i.materialOptions,"range-key":"name"},{default:r((()=>[h(M,{class:"picker-value"},{default:r((()=>[f(p(i.selectedMaterial?i.selectedMaterial.name:"è¯·é€‰æ‹©åŸæ–™/Vui lÃ²ng chá»n nguyÃªn liá»‡u"),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),i.selectedMaterial?(d(),c(M,{key:0,class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("åŸæ–™ç¼–å·")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(M,{class:"readonly-value"},{default:r((()=>[f(p(i.selectedMaterial.code||"æ— ç¼–å·"),1)])),_:1})])),_:1})])),_:1})):m("",!0),i.selectedMaterial?(d(),c(M,{key:1,class:"info-card"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("å½“å‰åº“å­˜ä¿¡æ¯")])),_:1}),h(M,{class:"info-row"},{default:r((()=>[h(x,{class:"info-label"},{default:r((()=>[f("å½“å‰åº“å­˜:")])),_:1}),h(x,{class:"info-value"},{default:r((()=>[f(p(i.selectedMaterial.stock)+p(i.selectedMaterial.unit),1)])),_:1})])),_:1}),h(M,{class:"info-row"},{default:r((()=>[h(x,{class:"info-label"},{default:r((()=>[f("å­˜å‚¨ä½ç½®:")])),_:1}),h(x,{class:"info-value"},{default:r((()=>[f(p(i.selectedMaterial.location),1)])),_:1})])),_:1}),h(M,{class:"info-row"},{default:r((()=>[h(x,{class:"info-label"},{default:r((()=>[f("æœ€ä½åº“å­˜:")])),_:1}),h(x,{class:"info-value"},{default:r((()=>[f(p(i.selectedMaterial.min_stock_warning)+p(i.selectedMaterial.unit),1)])),_:1})])),_:1})])),_:1})):m("",!0),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("å…¥åº“æ•°é‡")])),_:1}),h(M,{class:"quantity-row"},{default:r((()=>[h(M,{class:"input-box quantity-input"},{default:r((()=>[h(N,{type:"digit",modelValue:i.quantity,"onUpdate:modelValue":t[0]||(t[0]=e=>i.quantity=e),placeholder:"è¯·è¾“å…¥å…¥åº“æ•°é‡ / Nháº­p sá»‘ lÆ°á»£ng nháº­p kho"},null,8,["modelValue"])])),_:1}),h(M,{class:"unit-selector"},{default:r((()=>[h(b,{onChange:s.onUnitChange,value:i.unitIndex,range:i.unitOptions},{default:r((()=>[h(M,{class:"unit-display"},{default:r((()=>[f(p(i.displayUnit),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1})])),_:1}),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("ä¾›åº”å•†")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(N,{type:"text",modelValue:i.supplier,"onUpdate:modelValue":t[1]||(t[1]=e=>i.supplier=e),placeholder:"è¯·è¾“å…¥ä¾›åº”å•†åç§° / Nháº­p tÃªn nhÃ  cung cáº¥p"},null,8,["modelValue"])])),_:1})])),_:1}),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("å…¥åº“æ—¥æœŸ")])),_:1}),h(M,{class:"input-box date-picker"},{default:r((()=>[h(b,{mode:"date",value:i.date,onChange:s.onDateChange},{default:r((()=>[h(M,{class:"picker-value"},{default:r((()=>[f(p(i.date||"å¹´ /æœˆ/æ—¥"),1)])),_:1})])),_:1},8,["value","onChange"]),h(x,{class:"calendar-icon"},{default:r((()=>[f("ğŸ“…")])),_:1})])),_:1})])),_:1}),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("å¤‡æ³¨")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(B,{modelValue:i.remark,"onUpdate:modelValue":t[2]||(t[2]=e=>i.remark=e),placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ / Nháº­p thÃ´ng tin ghi chÃº","auto-height":""},null,8,["modelValue"])])),_:1})])),_:1}),h(M,{class:"btn-group"},{default:r((()=>[h(q,{class:"btn-primary",onClick:s.handleSubmit},{default:r((()=>[f("ç¡®è®¤å…¥åº“")])),_:1},8,["onClick"]),h(q,{class:"btn-secondary",onClick:s.handleCancel},{default:r((()=>[f("å–æ¶ˆ")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-6eaea7ed"]]);export{x as default};
