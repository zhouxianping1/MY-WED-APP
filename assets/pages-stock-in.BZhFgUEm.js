import{$ as e,g as t,Q as a,n as l,b as i,R as s,N as n,r as o,e as c,w as r,i as u,o as d,j as h,f,t as p,h as m,v as g,P as _,l as y,I as v,S as k,m as C}from"./index-D1azYyZI.js";import{C as M}from"./CustomNavBar.CZ4sq6xv.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=b({components:{CustomNavBar:M},data(){return{navBarHeight:64,materialOptions:[],materialIndex:0,selectedMaterial:null,quantity:"",supplier:"",date:this.formatDate(new Date),remark:"",loading:!1,unitOptions:["kg","t"],unitIndex:-1,displayUnit:"请选择单位"}},onLoad(){this.getNavBarHeight(),this.fetchMaterials()},methods:{getNavBarHeight(){e("updateNavBarHeight",(e=>{this.navBarHeight=e}));try{const e=t("navBarHeight");e&&(this.navBarHeight=e)}catch(a){}},async fetchMaterials(){var e;try{a({title:"加载中"});const t=await l.callFunction({name:"material",data:{action:"getMaterials",data:{page:1,pageSize:100}}});t.result&&0===t.result.code?(this.materialOptions=t.result.data.materials||[],this.materialOptions.length>0&&(this.selectedMaterial=this.materialOptions[0])):i({title:(null==(e=t.result)?void 0:e.msg)||"获取原料列表失败",icon:"none"})}catch(t){console.error("获取原料列表失败",t),i({title:"获取原料列表失败",icon:"none"})}finally{s()}},onMaterialChange(e){const t=e.detail.value;this.materialIndex=t,this.selectedMaterial=this.materialOptions[t]},onUnitChange(e){const t=e.detail.value;this.unitIndex=t,this.displayUnit=this.unitOptions[t]},onDateChange(e){this.date=e.detail.value},formatDate:e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,async handleSubmit(){var e;if(!this.selectedMaterial)return i({title:"请选择原料",icon:"none"});if(!this.quantity||isNaN(Number(this.quantity))||Number(this.quantity)<=0)return i({title:"请输入有效的入库数量",icon:"none"});if(-1===this.unitIndex)return i({title:"请选择单位",icon:"none"});if(!this.date)return i({title:"请选择入库日期",icon:"none"});try{this.loading=!0,a({title:"提交中"});let t=Number(this.quantity);"kg"===this.displayUnit&&(t/=1e3);const o=await l.callFunction({name:"stock-record",data:{action:"addStockRecord",data:{material_id:this.selectedMaterial._id,quantity:t,type:"in",remark:{text:`供应商: ${this.supplier||"未填写"}, 备注: ${this.remark||"无"}`}}}});o.result&&0===o.result.code?(i({title:"入库成功",icon:"success"}),setTimeout((()=>{n()}),1500)):i({title:(null==(e=o.result)?void 0:e.msg)||"入库失败",icon:"none"})}catch(t){console.error("入库操作失败",t),i({title:"入库操作失败",icon:"none"})}finally{this.loading=!1,s()}},handleCancel(){n()}}},[["render",function(e,t,a,l,i,s){const n=o("custom-nav-bar"),M=u,b=_,x=y,N=v,B=k,q=C;return d(),c(M,{class:"stock-in-container"},{default:r((()=>[h(n,{title:"入库操作",showBack:!0}),h(M,{class:"page-content",style:g({paddingTop:i.navBarHeight+20+"px"})},{default:r((()=>[h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("选择原料")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(b,{onChange:s.onMaterialChange,value:i.materialIndex,range:i.materialOptions,"range-key":"name"},{default:r((()=>[h(M,{class:"picker-value"},{default:r((()=>[f(p(i.selectedMaterial?i.selectedMaterial.name:"请选择原料/Vui lòng chọn nguyên liệu"),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),i.selectedMaterial?(d(),c(M,{key:0,class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("原料编号")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(M,{class:"readonly-value"},{default:r((()=>[f(p(i.selectedMaterial.code||"无编号"),1)])),_:1})])),_:1})])),_:1})):m("",!0),i.selectedMaterial?(d(),c(M,{key:1,class:"info-card"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("当前库存信息")])),_:1}),h(M,{class:"info-row"},{default:r((()=>[h(x,{class:"info-label"},{default:r((()=>[f("当前库存:")])),_:1}),h(x,{class:"info-value"},{default:r((()=>[f(p(i.selectedMaterial.stock)+p(i.selectedMaterial.unit),1)])),_:1})])),_:1}),h(M,{class:"info-row"},{default:r((()=>[h(x,{class:"info-label"},{default:r((()=>[f("存储位置:")])),_:1}),h(x,{class:"info-value"},{default:r((()=>[f(p(i.selectedMaterial.location),1)])),_:1})])),_:1}),h(M,{class:"info-row"},{default:r((()=>[h(x,{class:"info-label"},{default:r((()=>[f("最低库存:")])),_:1}),h(x,{class:"info-value"},{default:r((()=>[f(p(i.selectedMaterial.min_stock_warning)+p(i.selectedMaterial.unit),1)])),_:1})])),_:1})])),_:1})):m("",!0),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("入库数量")])),_:1}),h(M,{class:"quantity-row"},{default:r((()=>[h(M,{class:"input-box quantity-input"},{default:r((()=>[h(N,{type:"digit",modelValue:i.quantity,"onUpdate:modelValue":t[0]||(t[0]=e=>i.quantity=e),placeholder:"请输入入库数量 / Nhập số lượng nhập kho"},null,8,["modelValue"])])),_:1}),h(M,{class:"unit-selector"},{default:r((()=>[h(b,{onChange:s.onUnitChange,value:i.unitIndex,range:i.unitOptions},{default:r((()=>[h(M,{class:"unit-display"},{default:r((()=>[f(p(i.displayUnit),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1})])),_:1}),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("供应商")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(N,{type:"text",modelValue:i.supplier,"onUpdate:modelValue":t[1]||(t[1]=e=>i.supplier=e),placeholder:"请输入供应商名称 / Nhập tên nhà cung cấp"},null,8,["modelValue"])])),_:1})])),_:1}),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("入库日期")])),_:1}),h(M,{class:"input-box date-picker"},{default:r((()=>[h(b,{mode:"date",value:i.date,onChange:s.onDateChange},{default:r((()=>[h(M,{class:"picker-value"},{default:r((()=>[f(p(i.date||"年 /月/日"),1)])),_:1})])),_:1},8,["value","onChange"]),h(x,{class:"calendar-icon"},{default:r((()=>[f("📅")])),_:1})])),_:1})])),_:1}),h(M,{class:"form-section"},{default:r((()=>[h(M,{class:"section-title"},{default:r((()=>[f("备注")])),_:1}),h(M,{class:"input-box"},{default:r((()=>[h(B,{modelValue:i.remark,"onUpdate:modelValue":t[2]||(t[2]=e=>i.remark=e),placeholder:"请输入备注信息 / Nhập thông tin ghi chú","auto-height":""},null,8,["modelValue"])])),_:1})])),_:1}),h(M,{class:"btn-group"},{default:r((()=>[h(q,{class:"btn-primary",onClick:s.handleSubmit},{default:r((()=>[f("确认入库")])),_:1},8,["onClick"]),h(q,{class:"btn-secondary",onClick:s.handleCancel},{default:r((()=>[f("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-6eaea7ed"]]);export{x as default};
