import{$ as e,g as a,Q as t,n as l,b as s,R as i,K as n,N as o,r as c,e as r,w as d,i as u,o as f,j as h,f as m,t as g,h as _,v as p,P as v,l as M,S as y,m as b}from"./index-D1azYyZI.js";import{C}from"./CustomNavBar.CZ4sq6xv.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=B({components:{CustomNavBar:C},data:()=>({navBarHeight:64,materialOptions:[],materialIndex:0,selectedMaterial:null,deleteReason:"",loading:!1}),onLoad(){this.getNavBarHeight(),this.fetchMaterials()},methods:{getNavBarHeight(){e("updateNavBarHeight",(e=>{this.navBarHeight=e}));try{const e=a("navBarHeight");e&&(this.navBarHeight=e)}catch(t){}},async fetchMaterials(){var e;try{t({title:"加载中"});const a=await l.callFunction({name:"material",data:{action:"getMaterials",data:{page:1,pageSize:100}}});a.result&&0===a.result.code?(this.materialOptions=a.result.data.materials||[],this.materialOptions.length>0&&(this.selectedMaterial=this.materialOptions[0])):s({title:(null==(e=a.result)?void 0:e.msg)||"获取原料列表失败",icon:"none"})}catch(a){console.error("获取原料列表失败",a),s({title:"获取原料列表失败",icon:"none"})}finally{i()}},onMaterialChange(e){const a=e.detail.value;this.materialIndex=a,this.selectedMaterial=this.materialOptions[a]},async handleSubmit(){return this.selectedMaterial?this.deleteReason?void n({title:"确认删除",content:`确定要删除原料 "${this.selectedMaterial.name}" 吗？此操作不可恢复。`,success:async e=>{e.confirm&&await this.confirmDelete()}}):s({title:"请输入删除原因",icon:"none"}):s({title:"请选择原料",icon:"none"})},async confirmDelete(){var e;try{this.loading=!0,t({title:"删除中"});const a=await l.callFunction({name:"material",data:{action:"deleteMaterial",data:{materialId:this.selectedMaterial._id,deleteReason:this.deleteReason}}});a.result&&0===a.result.code?(s({title:"删除成功",icon:"success"}),setTimeout((()=>{o()}),1500)):s({title:(null==(e=a.result)?void 0:e.msg)||"删除失败",icon:"none"})}catch(a){console.error("删除原料失败",a),s({title:"删除原料失败",icon:"none"})}finally{this.loading=!1,i()}},handleCancel(){o()}}},[["render",function(e,a,t,l,s,i){const n=c("custom-nav-bar"),o=u,C=v,B=M,k=y,w=b;return f(),r(o,{class:"stock-delete-container"},{default:d((()=>[h(n,{title:"删除原料",showBack:!0}),h(o,{class:"page-content",style:p({paddingTop:s.navBarHeight+20+"px"})},{default:d((()=>[h(o,{class:"form-section"},{default:d((()=>[h(o,{class:"section-title"},{default:d((()=>[m("选择原料")])),_:1}),h(o,{class:"input-box"},{default:d((()=>[h(C,{onChange:i.onMaterialChange,value:s.materialIndex,range:s.materialOptions,"range-key":"name"},{default:d((()=>[h(o,{class:"picker-value"},{default:d((()=>[m(g(s.selectedMaterial?s.selectedMaterial.name:"请选择原料/Vui lòng chọn nguyên liệu"),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),s.selectedMaterial?(f(),r(o,{key:0,class:"info-card"},{default:d((()=>[h(o,{class:"section-title"},{default:d((()=>[m("原料信息")])),_:1}),h(o,{class:"info-row"},{default:d((()=>[h(B,{class:"info-label"},{default:d((()=>[m("原料名称:")])),_:1}),h(B,{class:"info-value"},{default:d((()=>[m(g(s.selectedMaterial.name),1)])),_:1})])),_:1}),h(o,{class:"info-row"},{default:d((()=>[h(B,{class:"info-label"},{default:d((()=>[m("编号:")])),_:1}),h(B,{class:"info-value"},{default:d((()=>[m(g(s.selectedMaterial.code),1)])),_:1})])),_:1}),h(o,{class:"info-row"},{default:d((()=>[h(B,{class:"info-label"},{default:d((()=>[m("当前库存:")])),_:1}),h(B,{class:"info-value"},{default:d((()=>[m(g(s.selectedMaterial.stock)+g(s.selectedMaterial.unit),1)])),_:1})])),_:1}),h(o,{class:"info-row"},{default:d((()=>[h(B,{class:"info-label"},{default:d((()=>[m("存储位置:")])),_:1}),h(B,{class:"info-value"},{default:d((()=>[m(g(s.selectedMaterial.location),1)])),_:1})])),_:1}),h(o,{class:"info-row"},{default:d((()=>[h(B,{class:"info-label"},{default:d((()=>[m("分类:")])),_:1}),h(B,{class:"info-value"},{default:d((()=>[m(g(s.selectedMaterial.category),1)])),_:1})])),_:1})])),_:1})):_("",!0),h(o,{class:"form-section"},{default:d((()=>[h(o,{class:"section-title"},{default:d((()=>[m("删除原因")])),_:1}),h(o,{class:"input-box"},{default:d((()=>[h(k,{modelValue:s.deleteReason,"onUpdate:modelValue":a[0]||(a[0]=e=>s.deleteReason=e),placeholder:"请输入删除原因 / Nhập lý do xóa","auto-height":""},null,8,["modelValue"])])),_:1})])),_:1}),h(o,{class:"btn-group"},{default:d((()=>[h(w,{class:"btn-danger",onClick:i.handleSubmit},{default:d((()=>[m("确认删除")])),_:1},8,["onClick"]),h(w,{class:"btn-secondary",onClick:i.handleCancel},{default:d((()=>[m("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-8f4c17b4"]]);export{k as default};
