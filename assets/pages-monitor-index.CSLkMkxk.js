import{$ as t,g as a,n as s,b as e,a as l,r as n,e as i,w as o,i as r,o as c,j as u,f as d,t as g,q as f,u as _,F as h,h as m,v as k,l as p}from"./index-D1azYyZI.js";import{C as w}from"./CustomNavBar.CZ4sq6xv.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=N({name:"MonitorPage",components:{CustomNavBar:w},data:()=>({navBarHeight:64,loading:!1,materials:[],warningList:[],zeroList:[]}),onLoad(){this.getNavBarHeight(),this.fetchStockWarnings()},onShow(){this.fetchStockWarnings()},methods:{getNavBarHeight(){t("updateNavBarHeight",(t=>{this.navBarHeight=t}));try{const t=a("navBarHeight");t&&(this.navBarHeight=t)}catch(s){}},async fetchStockWarnings(){try{this.loading=!0;const t=await s.callFunction({name:"material",data:{action:"getMaterials",data:{page:1,pageSize:1e3}}});t.result&&0===t.result.code?(this.materials=t.result.data.materials||[],this.categorizeByStock(),console.log("库存预警数据获取成功:",{totalMaterials:this.materials.length,warningCount:this.warningList.length,zeroCount:this.zeroList.length})):(console.error("获取原料数据失败:",t.result),e({title:"获取数据失败",icon:"none"}))}catch(t){console.error("获取库存预警数据失败:",t),e({title:"网络错误",icon:"none"})}finally{this.loading=!1}},categorizeByStock(){const t=[],a=[];return this.materials.forEach((s=>{const e=Number(s.stock)||0,l=Number(s.min_stock_warning)||0;e<=0?a.push(s):e<=l&&t.push(s)})),t.sort(((t,a)=>Number(t.stock)-Number(a.stock))),a.sort(((t,a)=>Number(t.stock)-Number(a.stock))),this.warningList=t,this.zeroList=a,{warningCount:t.length,zeroCount:a.length}},formatNumber(t){const a=Number(t);return isNaN(a)?"N/A":parseFloat(a.toFixed(3)).toString()},goToMaterialDetail(t){l({url:`/pages/material/detail?id=${t}`})}}},[["render",function(t,a,s,e,l,w){const N=p,v=r,L=n("custom-nav-bar");return c(),i(v,{class:"monitor-container"},{default:o((()=>[u(L,{title:"监控预警"},{right:o((()=>[u(v,{class:"nav-right"},{default:o((()=>[u(N,{class:"nav-icon"},{default:o((()=>[d("⚙️")])),_:1})])),_:1})])),_:1}),u(v,{class:"page-content",style:k({paddingTop:l.navBarHeight+20+"px"})},{default:o((()=>[u(v,{class:"alert-cards"},{default:o((()=>[u(v,{class:"alert-card warning"},{default:o((()=>[u(v,{class:"alert-icon"},{default:o((()=>[d("⚠️")])),_:1}),u(N,{class:"alert-text"},{default:o((()=>[d("发现 "+g(l.warningList.length)+" 个低库存警告",1)])),_:1})])),_:1}),u(v,{class:"alert-card danger"},{default:o((()=>[u(v,{class:"alert-icon"},{default:o((()=>[d("⛔")])),_:1}),u(N,{class:"alert-text"},{default:o((()=>[d("发现 "+g(l.zeroList.length)+" 个库存不足",1)])),_:1})])),_:1})])),_:1}),l.warningList.length>0?(c(),i(v,{key:0,class:"section"},{default:o((()=>[u(v,{class:"section-title"},{default:o((()=>[d("低库存警告")])),_:1}),u(v,{class:"stock-list"},{default:o((()=>[(c(!0),f(h,null,_(l.warningList,(t=>(c(),i(v,{class:"stock-item",key:t._id,onClick:a=>w.goToMaterialDetail(t._id)},{default:o((()=>[u(v,{class:"stock-icon warning-icon"},{default:o((()=>[d("⚠️")])),_:1}),u(v,{class:"stock-info"},{default:o((()=>[u(N,{class:"stock-name"},{default:o((()=>[d(g(t.name),1)])),_:2},1024),u(N,{class:"stock-details"},{default:o((()=>[d("当前："+g(w.formatNumber(t.stock))+g(t.unit)+" | 警告："+g(w.formatNumber(t.min_stock_warning))+g(t.unit),1)])),_:2},1024)])),_:2},1024),u(v,{class:"stock-status warning-status"},{default:o((()=>[u(N,{class:"status-text"},{default:o((()=>[d("警告")])),_:1})])),_:1})])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):m("",!0),l.zeroList.length>0?(c(),i(v,{key:1,class:"section"},{default:o((()=>[u(v,{class:"section-title"},{default:o((()=>[d("库存不足")])),_:1}),u(v,{class:"stock-list"},{default:o((()=>[(c(!0),f(h,null,_(l.zeroList,(t=>(c(),i(v,{class:"stock-item",key:t._id,onClick:a=>w.goToMaterialDetail(t._id)},{default:o((()=>[u(v,{class:"stock-icon danger-icon"},{default:o((()=>[d("🔴")])),_:1}),u(v,{class:"stock-info"},{default:o((()=>[u(N,{class:"stock-name"},{default:o((()=>[d(g(t.name),1)])),_:2},1024),u(N,{class:"stock-details"},{default:o((()=>[d("当前："+g(w.formatNumber(t.stock))+g(t.unit)+" | 警告："+g(w.formatNumber(t.min_stock_warning))+g(t.unit),1)])),_:2},1024)])),_:2},1024),u(v,{class:"stock-status danger-status"},{default:o((()=>[u(N,{class:"status-text"},{default:o((()=>[d("缺货")])),_:1})])),_:1})])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):m("",!0),0!==l.warningList.length||0!==l.zeroList.length||l.loading?m("",!0):(c(),i(v,{key:2,class:"no-warning"},{default:o((()=>[u(N,{class:"no-warning-text"},{default:o((()=>[d("🎉 暂无库存预警")])),_:1})])),_:1})),l.loading?(c(),i(v,{key:3,class:"loading"},{default:o((()=>[u(N,{class:"loading-text"},{default:o((()=>[d("正在加载...")])),_:1})])),_:1})):m("",!0)])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-34a5772f"]]);export{v as default};
