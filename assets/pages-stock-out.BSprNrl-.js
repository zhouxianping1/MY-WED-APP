import{$ as t,g as a,Q as e,n as l,b as i,R as n,N as s,r as o,e as r,w as c,i as u,o as d,j as h,f,t as m,h as g,v as p,P as _,l as v,I as y,S as k,m as M}from"./index-D1azYyZI.js";import{C}from"./CustomNavBar.CZ4sq6xv.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=b({components:{CustomNavBar:C},data(){return{navBarHeight:64,materialOptions:[],materialIndex:0,selectedMaterial:null,quantity:"",date:this.formatDate(new Date),remark:"",loading:!1,unitOptions:["kg","t"],unitIndex:-1,displayUnit:"è¯·é€‰æ‹©å•ä½"}},onLoad(){this.getNavBarHeight(),this.fetchMaterials()},methods:{getNavBarHeight(){t("updateNavBarHeight",(t=>{this.navBarHeight=t}));try{const t=a("navBarHeight");t&&(this.navBarHeight=t)}catch(e){}},async fetchMaterials(){var t;try{e({title:"åŠ è½½ä¸­"});const a=await l.callFunction({name:"material",data:{action:"getMaterials",data:{page:1,pageSize:100}}});a.result&&0===a.result.code?(this.materialOptions=a.result.data.materials||[],this.materialOptions.length>0&&(this.selectedMaterial=this.materialOptions[0])):i({title:(null==(t=a.result)?void 0:t.msg)||"è·å–åŸæ–™åˆ—è¡¨å¤±è´¥",icon:"none"})}catch(a){console.error("è·å–åŸæ–™åˆ—è¡¨å¤±è´¥",a),i({title:"è·å–åŸæ–™åˆ—è¡¨å¤±è´¥",icon:"none"})}finally{n()}},onMaterialChange(t){const a=t.detail.value;this.materialIndex=a,this.selectedMaterial=this.materialOptions[a]},onUnitChange(t){const a=t.detail.value;this.unitIndex=a,this.displayUnit=this.unitOptions[a]},onDateChange(t){this.date=t.detail.value},formatDate:t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,async handleSubmit(){var t;if(!this.selectedMaterial)return i({title:"è¯·é€‰æ‹©åŸæ–™",icon:"none"});if(!this.quantity||isNaN(Number(this.quantity))||Number(this.quantity)<=0)return i({title:"è¯·è¾“å…¥æœ‰æ•ˆçš„å‡ºåº“æ•°é‡",icon:"none"});if(-1===this.unitIndex)return i({title:"è¯·é€‰æ‹©å•ä½",icon:"none"});let a=Number(this.quantity);if("kg"===this.displayUnit&&(a/=1e3),a>this.selectedMaterial.stock)return i({title:"å‡ºåº“æ•°é‡ä¸èƒ½å¤§äºå½“å‰åº“å­˜",icon:"none"});if(!this.date)return i({title:"è¯·é€‰æ‹©å‡ºåº“æ—¥æœŸ",icon:"none"});try{this.loading=!0,e({title:"æäº¤ä¸­"});const o=await l.callFunction({name:"stock-record",data:{action:"addStockRecord",data:{material_id:this.selectedMaterial._id,quantity:a,type:"out",remark:{text:`å¤‡æ³¨: ${this.remark||"æ— "}`}}}});o.result&&0===o.result.code?(i({title:"å‡ºåº“æˆåŠŸ",icon:"success"}),setTimeout((()=>{s()}),1500)):i({title:(null==(t=o.result)?void 0:t.msg)||"å‡ºåº“å¤±è´¥",icon:"none"})}catch(o){console.error("å‡ºåº“æ“ä½œå¤±è´¥",o),i({title:"å‡ºåº“æ“ä½œå¤±è´¥",icon:"none"})}finally{this.loading=!1,n()}},handleCancel(){s()}}},[["render",function(t,a,e,l,i,n){const s=o("custom-nav-bar"),C=u,b=_,x=v,N=y,B=k,q=M;return d(),r(C,{class:"stock-out-container"},{default:c((()=>[h(s,{title:"å‡ºåº“æ“ä½œ",showBack:!0}),h(C,{class:"page-content",style:p({paddingTop:i.navBarHeight+20+"px"})},{default:c((()=>[h(C,{class:"form-section"},{default:c((()=>[h(C,{class:"section-title"},{default:c((()=>[f("é€‰æ‹©åŸæ–™")])),_:1}),h(C,{class:"input-box"},{default:c((()=>[h(b,{onChange:n.onMaterialChange,value:i.materialIndex,range:i.materialOptions,"range-key":"name"},{default:c((()=>[h(C,{class:"picker-value"},{default:c((()=>[f(m(i.selectedMaterial?i.selectedMaterial.name:"è¯·é€‰æ‹©åŸæ–™/Vui lÃ²ng chá»n nguyÃªn liá»‡u"),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1}),i.selectedMaterial?(d(),r(C,{key:0,class:"form-section"},{default:c((()=>[h(C,{class:"section-title"},{default:c((()=>[f("åŸæ–™ç¼–å·")])),_:1}),h(C,{class:"input-box"},{default:c((()=>[h(C,{class:"readonly-value"},{default:c((()=>[f(m(i.selectedMaterial.code||"æ— ç¼–å·"),1)])),_:1})])),_:1})])),_:1})):g("",!0),i.selectedMaterial?(d(),r(C,{key:1,class:"info-card"},{default:c((()=>[h(C,{class:"section-title"},{default:c((()=>[f("å½“å‰åº“å­˜ä¿¡æ¯")])),_:1}),h(C,{class:"info-row"},{default:c((()=>[h(x,{class:"info-label"},{default:c((()=>[f("å½“å‰åº“å­˜:")])),_:1}),h(x,{class:"info-value"},{default:c((()=>[f(m(i.selectedMaterial.stock)+m(i.selectedMaterial.unit),1)])),_:1})])),_:1}),h(C,{class:"info-row"},{default:c((()=>[h(x,{class:"info-label"},{default:c((()=>[f("å­˜å‚¨ä½ç½®:")])),_:1}),h(x,{class:"info-value"},{default:c((()=>[f(m(i.selectedMaterial.location),1)])),_:1})])),_:1}),h(C,{class:"info-row"},{default:c((()=>[h(x,{class:"info-label"},{default:c((()=>[f("æœ€ä½åº“å­˜:")])),_:1}),h(x,{class:"info-value"},{default:c((()=>[f(m(i.selectedMaterial.min_stock_warning)+m(i.selectedMaterial.unit),1)])),_:1})])),_:1})])),_:1})):g("",!0),h(C,{class:"form-section"},{default:c((()=>[h(C,{class:"section-title"},{default:c((()=>[f("å‡ºåº“æ•°é‡")])),_:1}),h(C,{class:"quantity-row"},{default:c((()=>[h(C,{class:"input-box quantity-input"},{default:c((()=>[h(N,{type:"digit",modelValue:i.quantity,"onUpdate:modelValue":a[0]||(a[0]=t=>i.quantity=t),placeholder:"è¯·è¾“å…¥å‡ºåº“æ•°é‡ / Nháº­p sá»‘ lÆ°á»£ng xuáº¥t kho"},null,8,["modelValue"])])),_:1}),h(C,{class:"unit-selector"},{default:c((()=>[h(b,{onChange:n.onUnitChange,value:i.unitIndex,range:i.unitOptions},{default:c((()=>[h(C,{class:"unit-display"},{default:c((()=>[f(m(i.displayUnit),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1})])),_:1})])),_:1}),h(C,{class:"form-section"},{default:c((()=>[h(C,{class:"section-title"},{default:c((()=>[f("å‡ºåº“æ—¥æœŸ")])),_:1}),h(C,{class:"input-box date-picker"},{default:c((()=>[h(b,{mode:"date",value:i.date,onChange:n.onDateChange},{default:c((()=>[h(C,{class:"picker-value"},{default:c((()=>[f(m(i.date||"å¹´ /æœˆ/æ—¥"),1)])),_:1})])),_:1},8,["value","onChange"]),h(x,{class:"calendar-icon"},{default:c((()=>[f("ğŸ“…")])),_:1})])),_:1})])),_:1}),h(C,{class:"form-section"},{default:c((()=>[h(C,{class:"section-title"},{default:c((()=>[f("å¤‡æ³¨")])),_:1}),h(C,{class:"input-box"},{default:c((()=>[h(B,{modelValue:i.remark,"onUpdate:modelValue":a[1]||(a[1]=t=>i.remark=t),placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ / Nháº­p thÃ´ng tin ghi chÃº","auto-height":""},null,8,["modelValue"])])),_:1})])),_:1}),h(C,{class:"btn-group"},{default:c((()=>[h(q,{class:"btn-primary",onClick:n.handleSubmit},{default:c((()=>[f("ç¡®è®¤å‡ºåº“")])),_:1},8,["onClick"]),h(q,{class:"btn-secondary",onClick:n.handleCancel},{default:c((()=>[f("å–æ¶ˆ")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-053b1406"]]);export{x as default};
