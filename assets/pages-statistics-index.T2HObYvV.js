import{$ as t,g as a,n as e,r as s,p as l,e as i,w as n,i as o,o as r,j as c,f as d,t as u,h as m,v as h,l as f}from"./index-D1azYyZI.js";import{_ as g,r as y}from"./qiun-data-charts.BjsE4O9X.js";import{C as p}from"./CustomNavBar.CZ4sq6xv.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=_({name:"StatisticsPage",components:{CustomNavBar:p,qiunDataCharts:g},data:()=>({navBarHeight:64,stats:{todayIn:0,todayOut:0,weeklyIn:0,weeklyOut:0,monthlyIn:0,monthlyOut:0},pieData:{series:[{name:"分类统计",data:[{name:"暂无数据",value:100}]}]},pieOpts:{padding:[15,15,0,15],dataLabel:!0,legend:{show:!0,position:"bottom",lineHeight:25},extra:{pie:{activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,border:!1,borderWidth:3,borderColor:"#FFFFFF"}}},stockRecords:[],categoryStats:[]}),onLoad(){this.getNavBarHeight(),this.fetchStockStatistics(),this.fetchCategoryStats()},computed:{formattedMonthlyIn(){if(this.stats.monthlyIn<.001)return{integer:"0",decimal:""};const t=this.stats.monthlyIn.toFixed(3).toString().split(".");return{integer:t[0],decimal:t[1]?`.${t[1]}`:""}},formattedMonthlyOut(){if(this.stats.monthlyOut<.001)return{integer:"0",decimal:""};const t=this.stats.monthlyOut.toFixed(3).toString().split(".");return{integer:t[0],decimal:t[1]?`.${t[1]}`:""}},formattedTodayIn(){if(this.stats.todayIn<.001)return{integer:"0",decimal:""};const t=this.stats.todayIn.toFixed(3).toString().split(".");return{integer:t[0],decimal:t[1]?`.${t[1]}`:""}},formattedTodayOut(){if(this.stats.todayOut<.001)return{integer:"0",decimal:""};const t=this.stats.todayOut.toFixed(3).toString().split(".");return{integer:t[0],decimal:t[1]?`.${t[1]}`:""}},formattedWeeklyIn(){if(this.stats.weeklyIn<.001)return{integer:"0",decimal:""};const t=this.stats.weeklyIn.toFixed(3).toString().split(".");return{integer:t[0],decimal:t[1]?`.${t[1]}`:""}},formattedWeeklyOut(){if(this.stats.weeklyOut<.001)return{integer:"0",decimal:""};const t=this.stats.weeklyOut.toFixed(3).toString().split(".");return{integer:t[0],decimal:t[1]?`.${t[1]}`:""}}},methods:{getNavBarHeight(){t("updateNavBarHeight",(t=>{this.navBarHeight=t}));try{const t=a("navBarHeight");t&&(this.navBarHeight=t)}catch(e){}},async fetchStockStatistics(){try{const t=new Date;t.setHours(0,0,0,0);const a=t.getTime(),s=new Date(t);s.setDate(t.getDate()-t.getDay()+(0===t.getDay()?-6:1));const l=s.getTime(),i=new Date(t.getFullYear(),t.getMonth(),1).getTime(),n=await e.callFunction({name:"stock-record",data:{action:"getStockRecords",data:{page:1,pageSize:1e3,startDate:i,endDate:Date.now()}}});if(n.result&&0===n.result.code){const t=n.result.data.records||[],e=t.filter((t=>t.date>=a)),s=this.calculateTotal(e,"in"),i=this.calculateTotal(e,"out"),o=t.filter((t=>t.date>=l)),r=this.calculateTotal(o,"in"),c=this.calculateTotal(o,"out"),d=this.calculateTotal(t,"in"),u=this.calculateTotal(t,"out");this.stats={todayIn:this.formatTonnage(s),todayOut:this.formatTonnage(i),weeklyIn:this.formatTonnage(r),weeklyOut:this.formatTonnage(c),monthlyIn:this.formatTonnage(d),monthlyOut:this.formatTonnage(u)},this.stockRecords=t}}catch(t){console.error("获取统计数据失败",t)}},calculateTotal:(t,a)=>t.filter((t=>t.type===a)).reduce(((t,a)=>t+a.quantity),0),formatTonnage:t=>t<.001?0:parseFloat(t.toFixed(3)),async fetchCategoryStats(){try{const t=await e.callFunction({name:"material",data:{action:"getMaterials",data:{page:1,pageSize:100}}});if(t.result&&0===t.result.code){const a=t.result.data.materials||[];if(a.length>0){const t=a.reduce(((t,a)=>t+a.stock),0),e=a.sort(((t,a)=>a.stock-t.stock)).slice(0,5),s=t-e.reduce(((t,a)=>t+a.stock),0),l=e.map((t=>({name:t.name,value:parseFloat(t.stock.toFixed(2))})));s>0&&l.push({name:"其他",value:parseFloat(s.toFixed(2))}),this.pieData={series:[{name:"分类统计",data:l}]}}else this.pieData={series:[{name:"分类统计",data:[{name:"暂无数据",value:100}]}]}}else this.pieData={series:[{name:"分类统计",data:[{name:"暂无数据",value:100}]}]}}catch(t){console.error("获取分类统计数据失败",t),this.pieData={series:[{name:"分类统计",data:[{name:"暂无数据",value:100}]}]}}}}},[["render",function(t,a,e,p,_,v){const k=s("custom-nav-bar"),F=f,O=o,I=y(l("qiun-data-charts"),g);return r(),i(O,{class:"statistics-container"},{default:n((()=>[c(k,{title:"统计报表"}),c(O,{class:"page-content",style:h({paddingTop:_.navBarHeight+20+"px"})},{default:n((()=>[c(O,{class:"stats-cards"},{default:n((()=>[c(O,{class:"stat-card purple"},{default:n((()=>[c(O,{class:"stat-number-container"},{default:n((()=>[c(F,{class:"stat-number-integer"},{default:n((()=>[d(u(v.formattedMonthlyIn.integer),1)])),_:1}),v.formattedMonthlyIn.decimal?(r(),i(F,{key:0,class:"stat-number-decimal"},{default:n((()=>[d(u(v.formattedMonthlyIn.decimal),1)])),_:1})):m("",!0)])),_:1}),c(F,{class:"stat-label"},{default:n((()=>[d("本月入库（吨）")])),_:1})])),_:1}),c(O,{class:"stat-card purple"},{default:n((()=>[c(O,{class:"stat-number-container"},{default:n((()=>[c(F,{class:"stat-number-integer"},{default:n((()=>[d(u(v.formattedMonthlyOut.integer),1)])),_:1}),v.formattedMonthlyOut.decimal?(r(),i(F,{key:0,class:"stat-number-decimal"},{default:n((()=>[d(u(v.formattedMonthlyOut.decimal),1)])),_:1})):m("",!0)])),_:1}),c(F,{class:"stat-label"},{default:n((()=>[d("本月出库（吨）")])),_:1})])),_:1})])),_:1}),c(O,{class:"chart-card"},{default:n((()=>[c(O,{class:"card-title"},{default:n((()=>[d("原料占比统计")])),_:1}),c(O,{class:"chart-container"},{default:n((()=>[c(I,{type:"pie",opts:_.pieOpts,chartData:_.pieData,canvas2d:!0,canvasId:"categoryPieChart"},null,8,["opts","chartData"])])),_:1})])),_:1}),c(O,{class:"stats-list-card"},{default:n((()=>[c(O,{class:"card-title"},{default:n((()=>[d("出入库统计")])),_:1}),c(O,{class:"stats-list"},{default:n((()=>[c(O,{class:"stats-list-item"},{default:n((()=>[c(F,{class:"stats-list-label"},{default:n((()=>[d("今日入库")])),_:1}),c(F,{class:"stats-list-value"},{default:n((()=>[d(u(_.stats.todayIn<.001?"0":_.stats.todayIn.toFixed(3))+"t",1)])),_:1})])),_:1}),c(O,{class:"stats-list-item"},{default:n((()=>[c(F,{class:"stats-list-label"},{default:n((()=>[d("今日出库")])),_:1}),c(F,{class:"stats-list-value"},{default:n((()=>[d(u(_.stats.todayOut<.001?"0":_.stats.todayOut.toFixed(3))+"t",1)])),_:1})])),_:1}),c(O,{class:"stats-list-item"},{default:n((()=>[c(F,{class:"stats-list-label"},{default:n((()=>[d("本周入库")])),_:1}),c(F,{class:"stats-list-value"},{default:n((()=>[d(u(_.stats.weeklyIn<.001?"0":_.stats.weeklyIn.toFixed(3))+"t",1)])),_:1})])),_:1}),c(O,{class:"stats-list-item"},{default:n((()=>[c(F,{class:"stats-list-label"},{default:n((()=>[d("本周出库")])),_:1}),c(F,{class:"stats-list-value"},{default:n((()=>[d(u(_.stats.weeklyOut<.001?"0":_.stats.weeklyOut.toFixed(3))+"t",1)])),_:1})])),_:1}),c(O,{class:"stats-list-item"},{default:n((()=>[c(F,{class:"stats-list-label"},{default:n((()=>[d("本月入库")])),_:1}),c(F,{class:"stats-list-value"},{default:n((()=>[d(u(_.stats.monthlyIn<.001?"0":_.stats.monthlyIn.toFixed(3))+"t",1)])),_:1})])),_:1}),c(O,{class:"stats-list-item"},{default:n((()=>[c(F,{class:"stats-list-label"},{default:n((()=>[d("本月出库")])),_:1}),c(F,{class:"stats-list-value"},{default:n((()=>[d(u(_.stats.monthlyOut<.001?"0":_.stats.monthlyOut.toFixed(3))+"t",1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-38abd270"]]);export{v as default};
