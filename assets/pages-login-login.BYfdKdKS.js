import{n as a,a as t,g as e,s,c as n,b as i,d as l,e as o,w as r,i as c,o as u,f as d,h,j as m,k as p,l as g,I as f,m as w}from"./index-D1azYyZI.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";function _(){return(navigator.userAgent||"").includes("Zalo")||window.location.href.includes("zalo")}const v=b({data:()=>({userName:"",avatarUrl:"",defaultAvatar:"/static/logo.png",loading:!1,isFromZalo:!1}),onLoad(){this.isFromZalo=_();const a=e("userInfo");a&&a.openid&&s({url:"/pages/index/index"})},onShow(){const a=e("lastUserName");a&&(this.userName=a)},methods:{chooseAvatar(){n({count:1,sizeType:["compressed"],success:a=>{this.avatarUrl=a.tempFilePaths[0]}})},async onSubmit(){if(this.userName.trim()){this.loading=!0;try{const t=this.avatarUrl||this.defaultAvatar,e=await async function(t,e){if(!t)throw new Error("æ˜µç§°ä¸èƒ½ä¸ºç©º / TÃªn khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng");let s="";if(e&&"/static/logo.png"!==e)try{const t=await new Promise(((a,t)=>{uni.getFileSystemManager().readFile({filePath:e,encoding:"base64",success:t=>a(t.data),fail:t})})),n=await a.callFunction({name:"user",data:{action:"uploadImage",data:{fileContent:t,fileType:e.split(".").pop()||"jpg"}}});0===n.result.code&&(s=n.result.data.fileID||n.result.data.url||"")}catch(i){console.warn("å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å¤´åƒ",i)}const{result:n}=await a.callFunction({name:"user",data:{action:"simpleLogin",data:{nickname:t,avatar:s}}});return n}(this.userName.trim(),t);if(0!==e.code)throw new Error(e.msg||"ç™»å½•å¤±è´¥");l("userInfo",e.data.userInfo),l("lastUserName",this.userName.trim()),i({icon:"success",title:this.isFromZalo?"ÄÄƒng nháº­p thÃ nh cÃ´ng":"ç™»å½•æˆåŠŸ"}),setTimeout((()=>{s({url:"/pages/index/index"})}),1500)}catch(t){console.error("ç™»å½•é”™è¯¯:",t),i({icon:"none",title:this.isFromZalo?"ÄÄƒng nháº­p tháº¥t báº¡i":"ç™»å½•å¤±è´¥ï¼š"+t.message})}finally{this.loading=!1}}else i({icon:"none",title:this.isFromZalo?"Vui lÃ²ng nháº­p biá»‡t danh":"è¯·å¡«å†™æ˜µç§°"})},backToZalo(){_()&&(window.history.length>1?window.history.back():t({url:"/pages/index/index"}))}}},[["render",function(a,t,e,s,n,i){const l=c,b=p,_=g,v=f,y=w;return u(),o(l,{class:"login-container"},{default:r((()=>[n.isFromZalo?(u(),o(l,{key:0,class:"back-to-zalo",onClick:i.backToZalo},{default:r((()=>[d(" â† Quay láº¡i Zalo ")])),_:1},8,["onClick"])):h("",!0),m(l,{class:"title"},{default:r((()=>[d("åŽŸæ–™ä»“åº“ç®¡ç†")])),_:1}),m(l,{class:"subtitle"},{default:r((()=>[d("å†…éƒ¨ç®¡ç†ç³»ç»Ÿ / Há»‡ thá»‘ng quáº£n lÃ½ ná»™i bá»™")])),_:1}),m(l,{class:"form-card"},{default:r((()=>[m(l,{class:"avatar-wrapper",onClick:i.chooseAvatar},{default:r((()=>[m(b,{src:n.avatarUrl||n.defaultAvatar,class:"avatar",mode:"aspectFill"},null,8,["src"]),m(_,{class:"avatar-tip"},{default:r((()=>[d("ç‚¹å‡»ä¸Šä¼ å¤´åƒï¼ˆå¯é€‰ï¼‰/ Chá»n áº£nh Ä‘áº¡i diá»‡n (tÃ¹y chá»n)")])),_:1})])),_:1},8,["onClick"]),m(l,{class:"input-item"},{default:r((()=>[m(_,{class:"input-icon"},{default:r((()=>[d("ðŸ‘¤")])),_:1}),m(v,{class:"nickname-input",type:"text",placeholder:"è¯·è¾“å…¥æ˜µç§° / Nháº­p biá»‡t danh",modelValue:n.userName,"onUpdate:modelValue":t[0]||(t[0]=a=>n.userName=a)},null,8,["modelValue"])])),_:1}),m(y,{class:"login-btn",type:"primary",loading:n.loading,onClick:i.onSubmit},{default:r((()=>[d(" ç™»å½• / ÄÄƒng nháº­p ")])),_:1},8,["loading","onClick"])])),_:1}),m(l,{class:"login-tip"},{default:r((()=>[m(_,{class:"tip-text"},{default:r((()=>[d("é¦–æ¬¡ä½¿ç”¨è¯·è¾“å…¥æ‚¨çš„æ˜µç§°")])),_:1}),m(_,{class:"tip-text"},{default:r((()=>[d("Láº§n Ä‘áº§u sá»­ dá»¥ng, vui lÃ²ng nháº­p biá»‡t danh cá»§a báº¡n")])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-7cb60b84"]]);export{v as default};
