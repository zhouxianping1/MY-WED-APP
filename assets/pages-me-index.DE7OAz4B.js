import{$ as a,g as e,J as t,d as s,b as n,n as o,K as l,L as c,M as i,r as u,e as r,w as d,i as f,o as m,j as g,f as h,t as _,v as p,k as x,l as v,m as k}from"./index-D1azYyZI.js";import{C}from"./CustomNavBar.CZ4sq6xv.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=y({name:"MePage",components:{CustomNavBar:C},data:()=>({navBarHeight:64,userInfo:{nickname:"",avatar:"",role:"",openid:""},loading:!1,defaultAvatar:"/static/logo.png"}),onLoad(){this.getNavBarHeight(),this.loadUserInfo()},onShow(){this.loadUserInfo()},methods:{getNavBarHeight(){a("updateNavBarHeight",(a=>{this.navBarHeight=a}));try{const a=e("navBarHeight");a&&(this.navBarHeight=a)}catch(t){}},loadUserInfo(){try{const a=e("userInfo");a?this.userInfo=a:this.goToLogin()}catch(a){console.error("获取用户信息失败:",a),this.goToLogin()}},getRoleText:a=>({admin:"系统管理员",operator:"仓库管理员",visitor:"访客用户"}[a]||"未知角色"),handleLanguageSetting(){t({itemList:["简体中文","Tiếng Việt"],success:a=>{const e=["zh","vi"][a.tapIndex];s("selectedLanguage",e),n({title:0===a.tapIndex?"已切换到简体中文":"Đã chuyển sang tiếng Việt",icon:"success"})}})},handleNotificationSetting(){n({title:"功能开发中",icon:"none"})},handleSecuritySetting(){n({title:"功能开发中",icon:"none"})},async handleDataExport(){"admin"===this.userInfo.role?t({itemList:["导出原料数据","导出出入库记录","导出用户数据"],success:async a=>{this.loading=!0;try{switch(a.tapIndex){case 0:await this.exportMaterialData();break;case 1:await this.exportStockRecords();break;case 2:await this.exportUserData()}}catch(e){n({title:"导出失败",icon:"none"})}this.loading=!1}}):n({title:"仅管理员可导出数据",icon:"none"})},async exportStockRecords(){try{const a=await o.callFunction({name:"stock-record",data:{action:"exportStockRecords",data:{}}});a.result&&0===a.result.code&&(n({title:"导出成功",icon:"success"}),console.log("导出数据:",a.result.data))}catch(a){throw console.error("导出出入库记录失败:",a),a}},async exportMaterialData(){n({title:"原料数据导出功能开发中",icon:"none"})},async exportUserData(){n({title:"用户数据导出功能开发中",icon:"none"})},handleAboutUs(){l({title:"关于我们",content:"注塑工厂原料仓库管理系统\n版本：v1.0.0\n\n专业的原料仓库管理解决方案",showCancel:!1,confirmText:"确定"})},handleLogout(){l({title:"确认退出",content:"确定要退出登录吗？",success:a=>{a.confirm&&(c("userInfo"),c("token"),this.goToLogin())}})},goToLogin(){i({url:"/pages/login/login"})}}},[["render",function(a,e,t,s,n,o){const l=u("custom-nav-bar"),c=x,i=f,C=v,y=k;return m(),r(i,{class:"me-container"},{default:d((()=>[g(l,{title:"个人中心"}),g(i,{class:"page-content",style:p({paddingTop:n.navBarHeight+20+"px"})},{default:d((()=>[g(i,{class:"user-card"},{default:d((()=>[g(i,{class:"user-avatar"},{default:d((()=>[g(c,{src:n.userInfo.avatar||n.defaultAvatar,class:"avatar-image",mode:"aspectFill"},null,8,["src"])])),_:1}),g(i,{class:"user-info"},{default:d((()=>[g(C,{class:"user-name"},{default:d((()=>[h(_(n.userInfo.nickname||"未登录"),1)])),_:1}),g(C,{class:"user-role"},{default:d((()=>[h(_(o.getRoleText(n.userInfo.role)),1)])),_:1})])),_:1})])),_:1}),g(i,{class:"menu-list"},{default:d((()=>[g(i,{class:"menu-item",onClick:o.handleLanguageSetting},{default:d((()=>[g(i,{class:"menu-left"},{default:d((()=>[g(i,{class:"menu-icon language-icon"},{default:d((()=>[h("🌐")])),_:1}),g(C,{class:"menu-text"},{default:d((()=>[h("语言设置")])),_:1})])),_:1}),g(C,{class:"menu-arrow"},{default:d((()=>[h(">")])),_:1})])),_:1},8,["onClick"]),g(i,{class:"menu-item",onClick:o.handleNotificationSetting},{default:d((()=>[g(i,{class:"menu-left"},{default:d((()=>[g(i,{class:"menu-icon notification-icon"},{default:d((()=>[h("🔔")])),_:1}),g(C,{class:"menu-text"},{default:d((()=>[h("通知设置")])),_:1})])),_:1}),g(C,{class:"menu-arrow"},{default:d((()=>[h(">")])),_:1})])),_:1},8,["onClick"]),g(i,{class:"menu-item",onClick:o.handleSecuritySetting},{default:d((()=>[g(i,{class:"menu-left"},{default:d((()=>[g(i,{class:"menu-icon security-icon"},{default:d((()=>[h("🛡️")])),_:1}),g(C,{class:"menu-text"},{default:d((()=>[h("安全设置")])),_:1})])),_:1}),g(C,{class:"menu-arrow"},{default:d((()=>[h(">")])),_:1})])),_:1},8,["onClick"]),g(i,{class:"menu-item",onClick:o.handleDataExport},{default:d((()=>[g(i,{class:"menu-left"},{default:d((()=>[g(i,{class:"menu-icon export-icon"},{default:d((()=>[h("📤")])),_:1}),g(C,{class:"menu-text"},{default:d((()=>[h("数据导出")])),_:1})])),_:1}),g(C,{class:"menu-arrow"},{default:d((()=>[h(">")])),_:1})])),_:1},8,["onClick"]),g(i,{class:"menu-item",onClick:o.handleAboutUs},{default:d((()=>[g(i,{class:"menu-left"},{default:d((()=>[g(i,{class:"menu-icon about-icon"},{default:d((()=>[h("ℹ️")])),_:1}),g(C,{class:"menu-text"},{default:d((()=>[h("关于我们")])),_:1})])),_:1}),g(C,{class:"menu-arrow"},{default:d((()=>[h(">")])),_:1})])),_:1},8,["onClick"])])),_:1}),g(i,{class:"logout-section"},{default:d((()=>[g(y,{class:"logout-btn",onClick:o.handleLogout},{default:d((()=>[h(" 退出登录 ")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-4fef91c8"]]);export{I as default};
