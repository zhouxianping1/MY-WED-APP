import{$ as a,g as t,n as e,b as s,N as l,a as r,r as i,e as c,w as o,i as d,o as n,j as u,f as m,t as f,O as _,h as g,q as p,u as h,F as k,v,l as y,x as b}from"./index-D1azYyZI.js";import{C as N}from"./CustomNavBar.CZ4sq6xv.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=B({components:{CustomNavBar:N},data:()=>({material:{},stockRecords:[],navBarHeight:64}),onLoad(a){a.id&&(this.fetchMaterialDetail(a.id),this.fetchStockRecords(a.id)),this.getNavBarHeight()},methods:{getNavBarHeight(){a("updateNavBarHeight",(a=>{this.navBarHeight=a}));try{const a=t("navBarHeight");a&&(this.navBarHeight=a)}catch(e){}},async fetchMaterialDetail(a){var t;const l=await e.callFunction({name:"material",data:{action:"getMaterialDetail",data:{materialId:a}}});l.result&&0===l.result.code?this.material=l.result.data:s({title:(null==(t=l.result)?void 0:t.msg)||"获取详情失败",icon:"none"})},async fetchStockRecords(a){const t=await e.callFunction({name:"stock-record",data:{action:"getRecordsByMaterial",data:{materialId:a}}});t.result&&0===t.result.code&&(this.stockRecords=t.result.data||[])},goBack(){l()},goEdit(){r({url:`/pages/material-add/index?id=${this.material._id}`})},formatTime(a){if(!a)return"未知时间";const t=new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},formatNumber(a){const t=Number(a);return isNaN(t)?"N/A":parseFloat(t.toFixed(3)).toString()}}},[["render",function(a,t,e,s,l,r){const N=y,B=d,w=i("custom-nav-bar");return n(),c(B,{class:"material-detail-bg"},{default:o((()=>[u(w,{title:l.material.name||"原料详情",showBack:!0},{right:o((()=>[u(B,{class:"edit-icon",onClick:r.goEdit},{default:o((()=>[u(N,{class:"icon"},{default:o((()=>[m("✎")])),_:1})])),_:1},8,["onClick"])])),_:1},8,["title"]),u(B,{class:"page-content",style:v({paddingTop:l.navBarHeight+20+"px"})},{default:o((()=>[u(B,{class:"info-card"},{default:o((()=>[u(B,{class:"icon-box"},{default:o((()=>[u(B,{class:"icon-bg"},{default:o((()=>[u(N,{class:"icon-main"},{default:o((()=>[m("🧊")])),_:1})])),_:1})])),_:1}),u(B,{class:"main-info"},{default:o((()=>[u(N,{class:"material-name"},{default:o((()=>[m(f(l.material.name),1)])),_:1}),u(N,{class:"material-code"},{default:o((()=>[m("编号: "+f(l.material.code),1)])),_:1})])),_:1}),u(B,{class:"stock-row"},{default:o((()=>[u(B,{class:"stock-block current"},{default:o((()=>[u(N,{class:"stock-value blue"},{default:o((()=>[m(f(r.formatNumber(l.material.stock)),1),_("span",{class:"unit"},f(l.material.unit),1)])),_:1}),u(N,{class:"stock-label"},{default:o((()=>[m("当前库存")])),_:1})])),_:1}),u(B,{class:"stock-block min"},{default:o((()=>[u(N,{class:"stock-value green"},{default:o((()=>[m(f(r.formatNumber(l.material.min_stock_warning)),1),_("span",{class:"unit"},f(l.material.unit),1)])),_:1}),u(N,{class:"stock-label"},{default:o((()=>[m("最低库存")])),_:1})])),_:1})])),_:1}),u(B,{class:"detail-list"},{default:o((()=>[u(B,{class:"detail-row"},{default:o((()=>[u(N,{class:"label"},{default:o((()=>[m("分类：")])),_:1}),u(N,{class:"value"},{default:o((()=>[m(f(l.material.category),1)])),_:1})])),_:1}),u(B,{class:"detail-row"},{default:o((()=>[u(N,{class:"label"},{default:o((()=>[m("存储位置：")])),_:1}),u(N,{class:"value"},{default:o((()=>[m(f(l.material.location),1)])),_:1})])),_:1}),u(B,{class:"detail-row"},{default:o((()=>[u(N,{class:"label"},{default:o((()=>[m("最后更新：")])),_:1}),u(N,{class:"value"},{default:o((()=>[m(f(r.formatTime(l.material.update_time||l.material.storage_time)),1)])),_:1})])),_:1}),u(B,{class:"detail-row"},{default:o((()=>[u(N,{class:"label"},{default:o((()=>[m("备注：")])),_:1}),u(N,{class:"value"},{default:o((()=>[m(f(l.material.remark&&l.material.remark.text?l.material.remark.text:"-"),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(B,{class:"record-card"},{default:o((()=>[u(B,{class:"record-title"},{default:o((()=>[m("库存变化记录")])),_:1}),0===l.stockRecords.length?(n(),c(B,{key:0,class:"no-record"},{default:o((()=>[m("暂无记录")])),_:1})):g("",!0),(n(!0),p(k,null,h(l.stockRecords,(a=>(n(),c(B,{key:a._id,class:b(["record-item",{in:"in"===a.type,out:"out"===a.type}])},{default:o((()=>[u(B,{class:b(["record-icon-bg",{in:"in"===a.type,out:"out"===a.type}])},{default:o((()=>[u(N,{class:"record-icon"},{default:o((()=>[m(f("in"===a.type?"+":"-"),1)])),_:2},1024)])),_:2},1032,["class"]),u(B,{class:"record-info"},{default:o((()=>[u(N,{class:"record-type"},{default:o((()=>[m(f("in"===a.type?"入库":"出库"),1)])),_:2},1024),u(N,{class:"record-date"},{default:o((()=>[m(f(r.formatTime(a.date)),1)])),_:2},1024)])),_:2},1024),u(N,{class:b(["record-quantity",{in:"in"===a.type,out:"out"===a.type}])},{default:o((()=>[m(f("in"===a.type?"+":"-")+f(r.formatNumber(a.quantity))+f(l.material.unit),1)])),_:2},1032,["class"])])),_:2},1032,["class"])))),128))])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-683af827"]]);export{w as default};
